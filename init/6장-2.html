<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 6: Memory Hierarchy (Ultimate Edition)</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap');

        :root {
            --primary: #4f46e5;
            --primary-light: #e0e7ff;
            --primary-dark: #4338ca;
            --secondary: #1e293b;
            --bg-main: #f8fafc;
            --text-main: #334155;
            --accent: #f43f5e;
            --accent-bg: #ffe4e6;
            --success: #10b981;
            --success-bg: #ecfdf5;
            --code-bg: #1e293b;
        }

        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Pretendard', sans-serif; background: var(--bg-main); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        /* ë ˆì´ì•„ì›ƒ */
        .sidebar { width: 280px; background: var(--secondary); color: white; display: flex; flex-direction: column; padding: 25px; flex-shrink: 0; overflow-y: auto; box-shadow: 4px 0 10px rgba(0,0,0,0.1); z-index: 10; }
        .main { flex: 1; padding: 40px 60px; overflow-y: auto; background: #f1f5f9; position: relative; }
        
        /* ì‚¬ì´ë“œë°” ìŠ¤íƒ€ì¼ */
        .brand { font-size: 1.5rem; font-weight: 800; margin-bottom: 40px; padding-bottom: 20px; border-bottom: 1px solid rgba(255,255,255,0.1); color: #fff; letter-spacing: -0.5px; }
        .brand span { font-size: 0.85rem; font-weight: 400; color: #94a3b8; margin-left: 5px; }
        
        .menu-label { font-size: 0.75rem; color: #94a3b8; font-weight: 700; margin: 20px 0 10px 5px; text-transform: uppercase; letter-spacing: 0.5px; }
        .nav-item { padding: 14px 15px; margin-bottom: 8px; border-radius: 10px; cursor: pointer; transition: all 0.2s ease; color: #cbd5e1; display: flex; align-items: center; font-weight: 500; }
        .nav-item:hover { background: rgba(255,255,255,0.1); color: #fff; transform: translateX(3px); }
        .nav-item.active { background: var(--primary); color: white; font-weight: 700; box-shadow: 0 4px 12px rgba(79, 70, 229, 0.3); }
        .nav-icon { margin-right: 12px; font-size: 1.2rem; }

        /* ë©”ì¸ ì½˜í…ì¸  ìŠ¤íƒ€ì¼ */
        .section-container { display: none; animation: slideIn 0.4s cubic-bezier(0.16, 1, 0.3, 1); max-width: 1100px; margin: 0 auto; }
        .section-container.active { display: block; }
        
        .header { margin-bottom: 40px; }
        .header h1 { font-size: 2.2rem; margin: 0 0 12px 0; color: #0f172a; font-weight: 800; letter-spacing: -1px; }
        .header p { font-size: 1.1rem; color: #64748b; }
        
        /* ì¹´ë“œ ê·¸ë¦¬ë“œ */
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(340px, 1fr)); gap: 30px; padding-bottom: 60px; }
        .card { background: #fff; border-radius: 20px; padding: 30px; border: 1px solid #e2e8f0; cursor: pointer; transition: all 0.3s ease; display: flex; flex-direction: column; position: relative; overflow: hidden; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .card:hover { transform: translateY(-6px); border-color: var(--primary); box-shadow: 0 20px 30px -5px rgba(0,0,0,0.1); }
        .card::before { content: ''; position: absolute; top: 0; left: 0; width: 100%; height: 6px; background: var(--primary); opacity: 0; transition: 0.3s; }
        .card:hover::before { opacity: 1; }
        
        .card-icon { font-size: 2.2rem; margin-bottom: 20px; background: var(--primary-light); width: 60px; height: 60px; display: flex; align-items: center; justify-content: center; border-radius: 16px; color: var(--primary); }
        .card h3 { font-size: 1.4rem; font-weight: 700; color: #1e293b; margin: 0 0 10px 0; }
        .card p { font-size: 1rem; color: #64748b; line-height: 1.6; margin-bottom: 25px; flex-grow: 1; }
        
        .btn-learn { margin-top: auto; background: #f8fafc; color: var(--primary); padding: 14px; border-radius: 12px; text-align: center; font-weight: 600; border: 1px solid #e2e8f0; transition: 0.2s; }
        .card:hover .btn-learn { background: var(--primary); color: white; border-color: var(--primary); }

        /* íƒœê·¸ */
        .tag-container { display: flex; gap: 8px; margin-bottom: 15px; }
        .tag { font-size: 0.75rem; padding: 5px 10px; border-radius: 6px; font-weight: 700; display: inline-block; letter-spacing: 0.5px; }
        .tag.core { background: #fee2e2; color: #ef4444; }
        .tag.exam { background: #dbeafe; color: #2563eb; }
        .tag.logic { background: #fef3c7; color: #d97706; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(15, 23, 42, 0.7); backdrop-filter: blur(5px); z-index: 1000; display: none; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s; }
        .modal-overlay.open { display: flex; opacity: 1; }
        
        .modal-content { background: #fff; width: 90%; max-width: 950px; height: 90vh; border-radius: 24px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.5); transform: scale(0.95); transition: transform 0.3s cubic-bezier(0.16, 1, 0.3, 1); }
        .modal-overlay.open .modal-content { transform: scale(1); }
        
        .modal-header { padding: 25px 35px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: #fff; z-index: 10; }
        .modal-title { font-size: 1.6rem; font-weight: 800; color: #0f172a; }
        .close-btn { font-size: 2rem; cursor: pointer; background: none; border: none; color: #94a3b8; transition: 0.2s; line-height: 1; }
        .close-btn:hover { color: var(--accent); transform: rotate(90deg); }
        
        .modal-body { padding: 40px; overflow-y: auto; line-height: 1.8; color: #334155; font-size: 1.05rem; }
        
        /* --- ì—…ê·¸ë ˆì´ë“œ ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ (High Polish) --- */
        
        /* 1. Univ AI ìŠ¤íƒ€ì¼ ì„¤ëª… ë°•ìŠ¤ */
        .easy-explain { background-color: var(--success-bg); border-left: 6px solid var(--success); padding: 25px; margin: 25px 0; border-radius: 0 12px 12px 0; box-shadow: 0 4px 6px -2px rgba(0,0,0,0.05); }
        .easy-explain h4 { color: #059669; margin: 0 0 12px 0; font-size: 1.15rem; display: flex; align-items: center; gap: 8px; }
        .easy-explain h4::before { content: 'ğŸ’¡'; font-size: 1.2rem; }
        .easy-explain ul { margin: 0; padding-left: 20px; }
        .easy-explain li { margin-bottom: 6px; }

        /* 2. ìˆ˜ì‹ í† ê¸€ (Accordion) */
        details { background: #fff; border-radius: 12px; border: 1px solid #e2e8f0; margin: 20px 0; overflow: hidden; transition: 0.3s; }
        details[open] { border-color: var(--primary); box-shadow: 0 4px 12px rgba(79, 70, 229, 0.1); }
        summary { font-weight: 700; color: var(--primary); padding: 15px 20px; cursor: pointer; background: #f8fafc; list-style: none; display: flex; justify-content: space-between; align-items: center; }
        summary::after { content: 'ğŸ‘‡'; font-size: 1.2rem; transition: 0.2s; }
        details[open] summary::after { transform: rotate(180deg); }
        .derivation { padding: 20px; font-size: 1rem; background: #fff; border-top: 1px solid #e2e8f0; }

        /* 3. íƒ­ ì¸í„°í˜ì´ìŠ¤ */
        .tab-container { margin-top: 30px; border: 1px solid #e2e8f0; border-radius: 16px; overflow: hidden; }
        .tab-header { display: flex; background: #f1f5f9; border-bottom: 1px solid #e2e8f0; }
        .tab-btn { flex: 1; padding: 15px; background: none; border: none; font-weight: 600; color: #64748b; cursor: pointer; transition: 0.2s; border-bottom: 3px solid transparent; }
        .tab-btn:hover { background: rgba(255,255,255,0.5); color: var(--primary); }
        .tab-btn.active { background: #fff; color: var(--primary); border-bottom-color: var(--primary); }
        .tab-pane { display: none; padding: 25px; background: #fff; }
        .tab-pane.active { display: block; animation: fadeIn 0.3s; }
        
        /* ì½”ë“œ ë¸”ë¡ (Dark Theme) */
        pre { background: var(--code-bg); color: #f8fafc; padding: 20px; border-radius: 12px; overflow-x: auto; font-family: 'Consolas', monospace; line-height: 1.5; box-shadow: inset 0 2px 4px rgba(0,0,0,0.3); }
        code { font-family: inherit; }
        .code-comment { color: #94a3b8; font-style: italic; }
        .code-highlight { color: #fb7185; font-weight: bold; background: rgba(251, 113, 133, 0.1); padding: 2px 4px; border-radius: 4px; }
        .code-keyword { color: #818cf8; }

        /* 4. ì‹œë®¬ë ˆì´ì…˜ UI (Interactive) */
        .sim-box { border: 2px solid #e2e8f0; padding: 30px; border-radius: 16px; text-align: center; margin: 25px 0; background: #fff; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.05); }
        .cache-container { display: flex; justify-content: center; gap: 20px; margin: 30px 0; align-items: flex-end; }
        .cache-slot-wrapper { text-align: center; }
        .slot-label { font-size: 0.85rem; color: #64748b; margin-bottom: 8px; font-weight: 600; }
        .cache-slot { width: 140px; height: 80px; border: 3px dashed #cbd5e1; display: flex; flex-direction: column; align-items: center; justify-content: center; border-radius: 12px; font-weight: 800; font-size: 1.2rem; color: #cbd5e1; transition: all 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); background: #f8fafc; }
        
        .cache-slot.filled { border-style: solid; border-color: var(--primary); background: var(--primary-light); color: var(--primary); transform: scale(1.05); box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.2); }
        .cache-slot.conflict { animation: shake 0.5s; border-color: var(--accent); background: var(--accent-bg); color: var(--accent); }
        
        .sim-log { margin-bottom: 20px; font-size: 1.1rem; color: #334155; font-weight: 500; min-height: 30px; }
        .sim-controls button { background: var(--primary); color: white; border: none; padding: 12px 30px; border-radius: 50px; cursor: pointer; font-weight: 700; font-size: 1rem; transition: 0.2s; box-shadow: 0 4px 6px -1px rgba(79, 70, 229, 0.3); }
        .sim-controls button:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: 0 10px 15px -3px rgba(79, 70, 229, 0.4); }
        .sim-controls button:active { transform: translateY(0); }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 20%, 60% { transform: translateX(-5px); } 40%, 80% { transform: translateX(5px); } }
        @keyframes slideIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

        .math-block { background: #fff; padding: 20px; border: 1px solid #e2e8f0; text-align: center; margin: 20px 0; border-radius: 12px; font-family: 'Times New Roman', serif; font-size: 1.3rem; font-style: italic; color: #1e293b; box-shadow: inset 0 0 10px rgba(0,0,0,0.02); }
        canvas { width: 100%; height: 240px; background: #fff; border: 1px solid #e2e8f0; border-radius: 12px; display: block; margin: 20px 0; }
        
        /* ì¶”ê°€ ìŠ¤íƒ€ì¼ */
        .tech-note {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
        }
        .tech-note h4 {
            margin: 0 0 10px 0;
            color: #475569;
            font-size: 1.1rem;
            font-weight: 700;
        }
        .exam-point {
            background: #fff1f2;
            border: 1px solid #fecdd3;
            border-radius: 12px;
            padding: 20px;
            margin: 25px 0;
        }
        .exam-point h4 {
            margin: 0 0 10px 0;
            color: #be123c;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        h3 {
            font-size: 1.3rem;
            color: var(--primary);
            margin: 30px 0 15px 0;
            font-weight: 700;
            border-left: 5px solid var(--primary);
            padding-left: 15px;
        }
        h4 {
            font-size: 1.1rem;
            color: #1e293b;
            margin: 20px 0 10px 0;
            font-weight: 700;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            background: #fff;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        th {
            background: #f1f5f9;
            color: #334155;
            font-weight: 700;
            text-align: center;
            padding: 12px;
            border-bottom: 2px solid #e2e8f0;
        }
        td {
            padding: 12px;
            border-bottom: 1px solid #e2e8f0;
            text-align: center;
            color: #475569;
        }
        tr:last-child td {
            border-bottom: none;
        }
        tr:hover {
            background: #f8fafc;
        }
        ul, ol {
            padding-left: 20px;
            margin-bottom: 20px;
        }
        li {
            margin-bottom: 8px;
        }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="brand">âš¡ Logic Master<br><span style="font-weight:400; font-size:0.9rem; opacity:0.8;">Ultimate Edition</span></div>
    <div class="menu-label">Chapter 6. Memory Hierarchy</div>
    <div class="nav-item active" onclick="showSection('sec-basic', this)"><span class="nav-icon">ğŸ“š</span> 1. ìºì‹œì˜ ê¸°ë³¸ ì›ë¦¬</div>
    <div class="nav-item" onclick="showSection('sec-mapping', this)"><span class="nav-icon">ğŸ—ºï¸</span> 2. ë§¤í•‘ê³¼ ì‹œë®¬ë ˆì´ì…˜</div>
    <div class="nav-item" onclick="showSection('sec-perf', this)"><span class="nav-icon">ğŸ“Š</span> 3. ì„±ëŠ¥ê³¼ ì •ì±…</div>
    <div class="nav-item" onclick="showSection('sec-opt', this)"><span class="nav-icon">ğŸš€</span> 4. ìµœì í™” (Blocking)</div>
</div>

<div class="main">
    <div id="sec-basic" class="section-container active">
        <div class="header"><h1>1. ìºì‹œ ë©”ëª¨ë¦¬ ê°œìš”</h1><p>ì†ë„ ì°¨ì´ë¥¼ ê·¹ë³µí•˜ëŠ” ë©”ëª¨ë¦¬ ê³„ì¸µ êµ¬ì¡°ì˜ í•µì‹¬</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('cache-concept')">
                <span class="card-icon">ğŸ°</span>
                <div class="tag-container"><span class="tag core">ê°œë…</span></div>
                <h3>ìºì‹œë€ ë¬´ì—‡ì¸ê°€?</h3>
                <p>CPUì™€ ë©”ì¸ ë©”ëª¨ë¦¬ ì‚¬ì´ì˜ ë³‘ëª© í˜„ìƒì„ í•´ê²°í•˜ëŠ” ê³ ì† ì™„ì¶© ì§€ëŒ€ì…ë‹ˆë‹¤.</p>
                <div class="btn-learn">ì‰¬ìš´ ì„¤ëª… (í˜¸í…” ë¹„ìœ )</div>
            </div>
            <div class="card" onclick="openModal('cache-org')">
                <span class="card-icon">ğŸ—‚ï¸</span>
                <div class="tag-container"><span class="tag exam">êµ¬ì¡°</span></div>
                <h3>S, E, B êµ¬ì¡°</h3>
                <p>Set(ì§‘í•©), Line(ë¼ì¸), Block(ë¸”ë¡)ìœ¼ë¡œ êµ¬ì„±ëœ ìºì‹œ ì£¼ì†Œ ì²´ê³„ ì™„ë²½ ì •ë¦¬.</p>
                <div class="btn-learn">ë„ì„œê´€ ë¹„ìœ  ë³´ê¸°</div>
            </div>
        </div>
    </div>

    <div id="sec-mapping" class="section-container">
        <div class="header"><h1>2. ë§¤í•‘ ë°©ì‹ê³¼ ì‹œë®¬ë ˆì´ì…˜</h1><p>ë°ì´í„° ì¶©ëŒì´ ì™œ ë°œìƒí•˜ëŠ”ì§€ ì§ì ‘ í™•ì¸í•´ë³´ì„¸ìš”.</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('direct-mapped')">
                <span class="card-icon">ğŸ•¹ï¸</span>
                <div class="tag-container"><span class="tag core">Interactive</span></div>
                <h3>Direct Mapped (E=1)</h3>
                <p>í•œ ì£¼ì†ŒëŠ” ì˜¤ì§ í•œ ê³³ì—ë§Œ! ì¶©ëŒ ë¯¸ìŠ¤(Conflict Miss) ë°œìƒ ê³¼ì •ì„ <strong>ì‹œë®¬ë ˆì´ì…˜</strong>ìœ¼ë¡œ ì²´í—˜í•©ë‹ˆë‹¤.</p>
                <div class="btn-learn">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘ â–¶</div>
            </div>
            <div class="card" onclick="openModal('set-associative')">
                <span class="card-icon">ğŸ¤</span>
                <div class="tag-container"><span class="tag exam">ë¹ˆì¶œ</span></div>
                <h3>Set Associative (E>1)</h3>
                <p>ìœ ì—°ì„±ì„ ë”í•´ ì¶©ëŒì„ ì¤„ì´ëŠ” ë°©ì‹. Eê°œì˜ ìë¦¬ ì¤‘ ë¹ˆ ê³³ì„ ì°¾ì•„ ë“¤ì–´ê°‘ë‹ˆë‹¤.</p>
                <div class="btn-learn">ë™ì‘ ì›ë¦¬ (Canvas)</div>
            </div>
        </div>
    </div>

    <div id="sec-perf" class="section-container">
        <div class="header"><h1>3. ì“°ê¸° ì •ì±… & ë©”ëª¨ë¦¬ ë§ˆìš´í‹´</h1><p>ë°ì´í„° ì¼ê´€ì„± ìœ ì§€ì™€ ì„±ëŠ¥ ì‹œê°í™”</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('write-policy')">
                <span class="card-icon">âœï¸</span>
                <div class="tag-container"><span class="tag logic">ì •ì±…</span></div>
                <h3>Write Policy</h3>
                <p>Write-Through vs Write-Back. ì„±ëŠ¥ê³¼ ì•ˆì „ì„± ì‚¬ì´ì˜ íŠ¸ë ˆì´ë“œì˜¤í”„.</p>
                <div class="btn-learn">ì •ì±… ë¹„êµí‘œ ë³´ê¸°</div>
            </div>
            <div class="card" onclick="openModal('mountain')">
                <span class="card-icon">â›°ï¸</span>
                <div class="tag-container"><span class="tag exam">ê·¸ë˜í”„</span></div>
                <h3>The Memory Mountain</h3>
                <p>Stride(ê³µê°„ ì§€ì—­ì„±)ì™€ Size(ì‹œê°„ ì§€ì—­ì„±)ì— ë”°ë¥¸ ì½ê¸° ì„±ëŠ¥ ë³€í™” ê·¸ë˜í”„.</p>
                <div class="btn-learn">ê·¸ë˜í”„ í•´ì„</div>
            </div>
        </div>
    </div>

    <div id="sec-opt" class="section-container">
        <div class="header"><h1>4. ìºì‹œ ì¹œí™”ì  ì½”ë“œ & ë¸”ë¡œí‚¹</h1><p>í”„ë¡œê·¸ë˜ë¨¸ê°€ í•  ìˆ˜ ìˆëŠ” ìµœì í™” ê¸°ë²•</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('loop-order')">
                <span class="card-icon">ğŸ”„</span>
                <div class="tag-container"><span class="tag logic">Code ë¶„ì„</span></div>
                <h3>Loop Reordering</h3>
                <p>ijk vs kij. ë£¨í”„ ìˆœì„œë§Œ ë°”ê¿”ë„ ì†ë„ê°€ ë¹¨ë¼ì§„ë‹¤? ì‹¤ì œ ì½”ë“œë¡œ í™•ì¸í•©ë‹ˆë‹¤.</p>
                <div class="btn-learn">ìƒì„¸ ë¶„ì„ ë³´ê¸°</div>
            </div>
            <div class="card" onclick="openModal('blocking')">
                <span class="card-icon">ğŸ§±</span>
                <div class="tag-container"><span class="tag exam">ìˆ˜ì‹ ìœ ë„</span></div>
                <h3>Blocking (Tiling)</h3>
                <p>í° í–‰ë ¬ì„ ì‘ì€ ë¸”ë¡ìœ¼ë¡œ ìª¼ê°œê¸°. <strong>ë¯¸ìŠ¤ìœ¨ ê³µì‹ ìœ ë„ ê³¼ì •</strong>ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.</p>
                <div class="btn-learn">ì›ë¦¬ ë° ìˆ˜ì‹</div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="window.closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">ì œëª©</div>
            <button class="close-btn" onclick="window.closeModal()">âœ•</button>
        </div>
        <div class="modal-body" id="modalBody">ë‚´ìš©</div>
    </div>
</div>

<script>
    // --- 1. ì „ì—­ ì´ˆê¸°í™” (ì•ˆì •ì„± ìµœìš°ì„ ) ---
    window.simStep = 0;

    function initializePage() {
        // ëª¨ë“  ì„¹ì…˜ ë¹„í™œì„±í™”
        var sections = document.querySelectorAll('.section-container');
        for(var i=0; i<sections.length; i++) sections[i].classList.remove('active');
        
        // ì²« ë²ˆì§¸ ì„¹ì…˜ í™œì„±í™”
        var firstSection = document.getElementById('sec-basic');
        if(firstSection) firstSection.classList.add('active');
        
        // ë„¤ë¹„ê²Œì´ì…˜ ì´ˆê¸°í™”
        var navs = document.querySelectorAll('.nav-item');
        for(var i=0; i<navs.length; i++) navs[i].classList.remove('active');
        var firstNav = document.querySelector('.nav-item');
        if(firstNav) firstNav.classList.add('active');
    }

    // ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜
    window.showSection = function(id, el) {
        var sections = document.querySelectorAll('.section-container');
        for(var i=0; i<sections.length; i++) sections[i].classList.remove('active');
        document.getElementById(id).classList.add('active');

        var navs = document.querySelectorAll('.nav-item');
        for(var i=0; i<navs.length; i++) navs[i].classList.remove('active');
        el.classList.add('active');
    }

    // --- 2. ëª¨ë‹¬ ì œëª© ì •ì˜ ---
    const modalTitles = {
        'cache-concept': 'ìºì‹œ ë©”ëª¨ë¦¬ë€?',
        'cache-org': 'ìºì‹œì˜ ì£¼ì†Œ êµ¬ì¡° (S, E, B)',
        'direct-mapped': 'Direct Mapped Cache ì‹œë®¬ë ˆì´ì…˜',
        'set-associative': 'Set Associative Cache ë™ì‘',
        'write-policy': 'ì“°ê¸° ì •ì±… (Write Policy)',
        'mountain': 'ë©”ëª¨ë¦¬ ë§ˆìš´í‹´ (Memory Mountain)',
        'loop-order': 'ë£¨í”„ ìˆœì„œì™€ ê³µê°„ ì§€ì—­ì„±',
        'blocking': 'ë¸”ë¡œí‚¹ (Blocking) ê¸°ë²•'
    };

    // --- 3. ì½˜í…ì¸  ë°ì´í„° (í’ë¶€í•œ ë‚´ìš©) ---
    const contents = {
        'cache-concept': `
            <h3>ìºì‹œ ë©”ëª¨ë¦¬ ê°œìš”</h3>
            <div class="easy-explain">
                <h4>ğŸ“ Univ AIì˜ ì‰¬ìš´ ì„¤ëª…: í˜¸í…” ê¸ˆê³  ë¹„ìœ </h4>
                <p>Intel Core i7ì˜ ìºì‹œ ê³„ì¸µì„ <strong>í˜¸í…” ì„œë¹„ìŠ¤</strong>ì— ë¹„ìœ í•´ë³¼ê¹Œìš”?</p>
                <ul>
                    <li><strong>L1 ìºì‹œ (ê°œì¸ ê¸ˆê³ ):</strong> ë°© ì•ˆì— ìˆì–´ì„œ ê°€ì¥ ë¹ ë¥´ì§€ë§Œ, ì•„ì£¼ ê·€ì¤‘í•œ ì†ŒëŸ‰ë§Œ ë„£ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ì ‘ê·¼: 4 cycle)</li>
                    <li><strong>L2 ìºì‹œ (ë°© ì•ˆì˜ ì˜·ì¥):</strong> ê¸ˆê³ ë³´ë‹¤ í¬ì§€ë§Œ, ë¬¸ì„ ì—´ê³  ë‹«ëŠ” ë° ì‹œê°„ì´ ì¡°ê¸ˆ ë” ê±¸ë¦½ë‹ˆë‹¤. (ì ‘ê·¼: 11 cycle)</li>
                    <li><strong>L3 ìºì‹œ (í˜¸í…” ë¡œë¹„ ì°½ê³ ):</strong> ëª¨ë“  íˆ¬ìˆ™ê°(ì½”ì–´)ì´ ê³µìœ í•˜ë©° ê°€ì¥ í½ë‹ˆë‹¤. ë¡œë¹„ê¹Œì§€ ë‹¤ë…€ì™€ì•¼ í•©ë‹ˆë‹¤. (ì ‘ê·¼: 30-40 cycle)</li>
                    <li><strong>ë©”ì¸ ë©”ëª¨ë¦¬ (ì§‘):</strong> í˜¸í…” ë°– ë©€ë¦¬ ìˆëŠ” ì§‘ì…ë‹ˆë‹¤. í•œë²ˆ ë‹¤ë…€ì˜¤ë ¤ë©´ ì•„ì£¼ ì˜¤ë˜ ê±¸ë¦½ë‹ˆë‹¤. (ì ‘ê·¼: 100+ cycle)</li>
                </ul>
            </div>
            <p>CPUëŠ” ë°ì´í„°ë¥¼ ì°¾ì„ ë•Œ <strong>L1 â†’ L2 â†’ L3 â†’ ë©”ëª¨ë¦¬</strong> ìˆœì„œë¡œ ë’¤ì§‘ë‹ˆë‹¤. ê°€ê¹Œìš´ ê³³ì—ì„œ ì°¾ì„ìˆ˜ë¡(Hit) ì‹œìŠ¤í…œ ì„±ëŠ¥ì´ ë¹„ì•½ì ìœ¼ë¡œ í–¥ìƒë©ë‹ˆë‹¤.</p>
        `,
        'cache-org': `
            <h3>ìºì‹œ ì£¼ì†Œ êµ¬ì¡° (S, E, B)</h3>
            <div class="easy-explain">
                <h4>ğŸ“š ë„ì„œê´€ ë¹„ìœ : ì±… ì°¾ê¸°</h4>
                <p>ê±°ëŒ€í•œ ë„ì„œê´€(ë©”ëª¨ë¦¬)ì—ì„œ ì±…(ë°ì´í„°)ì„ ë¹ ë¥´ê²Œ ì°¾ê¸° ìœ„í•´ ì£¼ì†Œë¥¼ 3ë¶€ë¶„ìœ¼ë¡œ ë‚˜ëˆ•ë‹ˆë‹¤.</p>
                <ul>
                    <li><strong>Set Index (S):</strong> <strong>'ì±…ì¥ ë²ˆí˜¸'</strong>ì…ë‹ˆë‹¤. ì£¼ì†Œë¥¼ ë³´ê³  ëª‡ ë²ˆ ì±…ì¥ìœ¼ë¡œ ê°ˆì§€ ê°€ì¥ ë¨¼ì € ê²°ì •í•©ë‹ˆë‹¤.</li>
                    <li><strong>Tag (T):</strong> ì±…ì¥ì— ê½‚íŒ ì±…ì˜ <strong>'ì œëª©(ID)'</strong>ì…ë‹ˆë‹¤. ë‚´ê°€ ì°¾ëŠ” ê·¸ ì±…ì´ ë§ëŠ”ì§€ í™•ì¸í•˜ëŠ” ìš©ë„ì…ë‹ˆë‹¤.</li>
                    <li><strong>Block Offset (B):</strong> ì±…ì„ í¼ì³¤ì„ ë•Œ <strong>'ëª‡ í˜ì´ì§€'</strong>ë¥¼ ì½ì„ì§€ ê²°ì •í•©ë‹ˆë‹¤.</li>
                </ul>
            </div>
            <div class="math-block">
                Address = [ Tag ] [ Set Index ] [ Block Offset ]
            </div>
            <ul>
                <li>ìºì‹œ í¬ê¸°(C) = S Ã— E Ã— B (ì„¸íŠ¸ ìˆ˜ Ã— ë¼ì¸ ìˆ˜ Ã— ë¸”ë¡ í¬ê¸°)</li>
                <li>ìœ íš¨ ë¹„íŠ¸(Valid Bit): í•´ë‹¹ ìë¦¬ì— ì‹¤ì œ ë°ì´í„°ê°€ ìˆëŠ”ì§€(1) ì“°ë ˆê¸° ê°’ì¸ì§€(0) í‘œì‹œí•©ë‹ˆë‹¤.</li>
            </ul>
        `,
        'direct-mapped': `
            <h3>Direct Mapped Cache ì‹œë®¬ë ˆì´ì…˜</h3>
            <p>ê°€ì¥ ë‹¨ìˆœí•˜ì§€ë§Œ ì¶©ëŒì´ ì¦ì€ êµ¬ì¡°ì…ë‹ˆë‹¤. ì£¼ì†Œ 0ë²ˆê³¼ 8ë²ˆì´ ê°™ì€ <strong>Set 0</strong>ì— ë§¤í•‘ë˜ì–´ ì„œë¡œë¥¼ ë°€ì–´ë‚´ëŠ”(Thrashing) ìƒí™©ì„ ì‹œë®¬ë ˆì´ì…˜í•©ë‹ˆë‹¤.</p>
            
            <div class="sim-box">
                <div class="cache-container">
                    <div class="cache-slot-wrapper">
                        <div class="slot-label">Set 0 (ë¼ì¸ 1ê°œë¿)</div>
                        <div class="cache-slot" id="sim-slot">Empty</div>
                    </div>
                </div>
                <div class="sim-log" id="sim-log">ğŸ‘‡ ì•„ë˜ ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
                <div class="sim-controls">
                    <button onclick="window.nextSimStep()">ë‹¤ìŒ ë‹¨ê³„ ì§„í–‰ â–¶</button>
                </div>
            </div>
            
            <div class="exam-point">
                <h4>ğŸš© í•µì‹¬: ì¶©ëŒ ë¯¸ìŠ¤ (Conflict Miss)</h4>
                <p>ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°(0ë²ˆ, 8ë²ˆ)ê°€ ìš°ì—°íˆ ê°™ì€ Set Indexë¥¼ ê°€ì§ˆ ë•Œ ë°œìƒí•©ë‹ˆë‹¤. Direct MappedëŠ” ìë¦¬ê°€ í•˜ë‚˜ë¿ì´ë¼ ê¸°ì¡´ ë°ì´í„°ë¥¼ ë¬´ì¡°ê±´ ì«“ì•„ë‚´ì•¼ í•©ë‹ˆë‹¤.</p>
            </div>
        `,
        'set-associative': `
            <h3>E-way Set Associative Cache</h3>
            <p>Direct Mappedì˜ ë‹¨ì ì„ í•´ê²°í•˜ê¸° ìœ„í•´, í•œ Setì— <strong>Eê°œì˜ ìë¦¬(Line)</strong>ë¥¼ ë§ˆë ¨í–ˆìŠµë‹ˆë‹¤. ì´ì œ ìë¦¬ê°€ ë¶€ì¡±í•  ì¼ì´ ì¤„ì–´ë“­ë‹ˆë‹¤.</p>
            
            <div class="easy-explain">
                <h4>ğŸ’¡ ìœ ì—°í•œ ì €ì¥ì†Œ</h4>
                <p>ë§ˆì¹˜ ë„ì„œê´€ ì±…ì¥(Set) í•œ ì¹¸ì— ì±…ì„ ê½‚ì„ ìë¦¬ê°€ 2ê°œ(2-way) ìˆëŠ” ê²ƒê³¼ ê°™ìŠµë‹ˆë‹¤. <br>
                ì´ë¯¸ í•œ ìë¦¬ê°€ ì°¼ë”ë¼ë„, ì˜†ìë¦¬ê°€ ë¹„ì–´ìˆìœ¼ë©´ ê¸°ì¡´ ì±…ì„ ë²„ë¦¬ì§€ ì•Šê³  ìƒˆ ì±…ì„ ê½‚ì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
            </div>

            <canvas id="cvs_assoc"></canvas>
            
            <ul>
                <li><strong>ë³‘ë ¬ ê²€ìƒ‰:</strong> í•´ë‹¹ Setì— ìˆëŠ” Eê°œì˜ Tagë¥¼ <strong>ë™ì‹œì— ë¹„êµ</strong>í•˜ë¯€ë¡œ ì†ë„ê°€ ë¹ ë¦…ë‹ˆë‹¤.</li>
                <li><strong>êµì²´ ì •ì±…:</strong> ë§Œì•½ Eê°œì˜ ìë¦¬ê°€ ë‹¤ ì°¼ë‹¤ë©´? ë³´í†µ <strong>LRU (ê°€ì¥ ì˜¤ë«ë™ì•ˆ ì•ˆ ì“´ ê²ƒ)</strong>ë¥¼ ë²„ë¦¬ê³  ìƒˆ ë°ì´í„°ë¥¼ ë„£ìŠµë‹ˆë‹¤.</li>
            </ul>
        `,
        'write-policy': `
            <h3>ì“°ê¸° ì •ì±… (Write Policy)</h3>
            <p>ìºì‹œì˜ ë‚´ìš©ì´ ë³€ê²½ë˜ì—ˆì„ ë•Œ, ë©”ì¸ ë©”ëª¨ë¦¬ì—ëŠ” ì–¸ì œ ë°˜ì˜í• ê¹Œìš”? ì†ë„ì™€ ì•ˆì „ì„± ì‚¬ì´ì˜ ì„ íƒì…ë‹ˆë‹¤.</p>

            <table>
                <tr>
                    <th>ë°©ì‹</th>
                    <th>ì„¤ëª…</th>
                    <th>ì¥ì  ë° ë‹¨ì </th>
                </tr>
                <tr>
                    <td><strong>Write-Through</strong></td>
                    <td>ìºì‹œì™€ ë©”ëª¨ë¦¬ì— <strong>ë™ì‹œì—</strong> ì”ë‹ˆë‹¤.</td>
                    <td>ë°ì´í„°ê°€ í•­ìƒ ì¼ì¹˜í•˜ì—¬ ì•ˆì „í•˜ì§€ë§Œ, ë©”ëª¨ë¦¬ ì ‘ê·¼ ì†ë„ê°€ ëŠë ¤ <strong>ì „ì²´ ì„±ëŠ¥ì´ ì €í•˜</strong>ë©ë‹ˆë‹¤.</td>
                </tr>
                <tr>
                    <td><strong>Write-Back</strong></td>
                    <td><strong>ìºì‹œì—ë§Œ</strong> ì“°ê³ , ë‚˜ì¤‘ì— ì«“ê²¨ë‚  ë•Œ ë©”ëª¨ë¦¬ì— ì”ë‹ˆë‹¤.</td>
                    <td><strong>ë¹ ë¦…ë‹ˆë‹¤.</strong> í•˜ì§€ë§Œ ë°ì´í„°ê°€ ë³€ê²½ë˜ì—ˆìŒì„ í‘œì‹œí•˜ëŠ” 'Dirty Bit' ê´€ë¦¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.</td>
                </tr>
            </table>

            <div class="tech-note">
                <h4>Write Miss ì •ì±… (ë°ì´í„°ê°€ ìºì‹œì— ì—†ì„ ë•Œ)</h4>
                <ul>
                    <li><strong>Write Allocate:</strong> ë©”ëª¨ë¦¬ì—ì„œ ë°ì´í„°ë¥¼ ìºì‹œë¡œ ê°€ì ¸ì˜¨ ë’¤ ì”ë‹ˆë‹¤. (ì£¼ë¡œ Write-Backê³¼ ì§ê¿)</li>
                    <li><strong>No-Write Allocate:</strong> ìºì‹œë¥¼ ê±´ë„ˆë›°ê³  ë©”ëª¨ë¦¬ì— ë°”ë¡œ ì”ë‹ˆë‹¤. (ì£¼ë¡œ Write-Throughì™€ ì§ê¿)</li>
                </ul>
            </div>
        `,
        'mountain': `
            <h3>The Memory Mountain</h3>
            <p>í”„ë¡œê·¸ë¨ì˜ ì§€ì—­ì„±(Locality)ì— ë”°ë¥¸ ë°ì´í„° ì²˜ë¦¬ ì†ë„(Throughput)ë¥¼ 3ì°¨ì› ì‚°ë§¥ì²˜ëŸ¼ ì‹œê°í™”í•œ ê·¸ë˜í”„ì…ë‹ˆë‹¤.</p>
            
            <ul>
                <li><strong>Ridges (ëŠ¥ì„ ) - ì‹œê°„ ì§€ì—­ì„±:</strong> ë°ì´í„° í¬ê¸°(Working Set)ê°€ ì‘ì•„ì„œ L1, L2 ìºì‹œ ì•ˆì— ì™ ë“¤ì–´ê°ˆìˆ˜ë¡ ì½ê¸° ì†ë„(ë†’ì´)ê°€ ë†’ìŠµë‹ˆë‹¤. í‰í‰í•œ ê³ ì›ì²˜ëŸ¼ ë³´ì…ë‹ˆë‹¤.</li>
                <li><strong>Slopes (ë¹„íƒˆ) - ê³µê°„ ì§€ì—­ì„±:</strong> Stride(ë³´í­)ê°€ ì‘ì„ìˆ˜ë¡(ìˆœì°¨ ì ‘ê·¼) ì„±ëŠ¥ì´ ì¢‹ìŠµë‹ˆë‹¤. Strideê°€ ì»¤ì§€ë©´ ìºì‹œ ë¯¸ìŠ¤ê°€ ëŠ˜ì–´ë‚˜ ë¹„íƒˆê¸¸ì„ ë”°ë¼ ì„±ëŠ¥ì´ ëš ë–¨ì–´ì§‘ë‹ˆë‹¤.</li>
            </ul>
            <p><strong>ê²°ë¡ :</strong> ìš°ë¦¬ëŠ” ì‚°ì˜ ì •ìƒ(L1 ìºì‹œ ì˜ì—­)ì— ë¨¸ë¬´ë¥´ë„ë¡ ì½”ë“œë¥¼ ì§œì•¼ í•©ë‹ˆë‹¤.</p>
        `,
        'loop-order': `
            <h3>í–‰ë ¬ ê³±ì…ˆ ë£¨í”„ ìˆœì„œ ìµœì í™”</h3>
            <div class="easy-explain">
                <h4>ğŸ³ ìš”ë¦¬ì‚¬ ë¹„ìœ : ì¬ë£Œ ì¤€ë¹„</h4>
                <p>ë°°ì—´ì€ ë©”ëª¨ë¦¬ì— ê°€ë¡œë¡œ ì­‰ ë‚˜ì—´ë˜ì–´ ìˆìŠµë‹ˆë‹¤(Row-major). <br>
                <strong>ìˆœì„œëŒ€ë¡œ ì½ëŠ” ê²ƒ(Stride-1)</strong>ì€ ì¬ë£Œë¥¼ ìˆœì„œëŒ€ë¡œ ì§‘ëŠ” ê²ƒì´ê³ , <strong>ê±´ë„ˆë›°ë©° ì½ëŠ” ê²ƒ</strong>ì€ ì¬ë£Œ í•˜ë‚˜ ì§‘ê³  ì € ë©€ë¦¬ ê°€ì„œ ë‹¤ë¥¸ ì¬ë£Œë¥¼ ì§‘ì–´ì˜¤ëŠ” ê²©ì…ë‹ˆë‹¤.</p>
            </div>

            <div class="tab-container">
                <div class="tab-header">
                    <button class="tab-btn active" onclick="window.switchTab('summary', this)">ìš”ì•½í‘œ</button>
                    <button class="tab-btn" onclick="window.switchTab('code', this)">ìƒì„¸ ì½”ë“œ ë¶„ì„</button>
                </div>
                
                <div id="tab-summary" class="tab-pane active">
                    <table>
                        <tr><th>ì½”ë“œ ìˆœì„œ</th><th>ì ‘ê·¼ íŒ¨í„´</th><th>Misses/Iter</th><th>ì„±ëŠ¥</th></tr>
                        <tr><td><code>kij</code>, <code>ikj</code></td><td><strong>Stride-1 (ìˆœì°¨)</strong></td><td>0.5 (ìµœì†Œ)</td><td>ğŸš€ Best</td></tr>
                        <tr><td><code>ijk</code>, <code>jik</code></td><td>í˜¼í•© (Row/Col)</td><td>1.25</td><td>Normal</td></tr>
                        <tr><td><code>jki</code>, <code>kji</code></td><td><strong>Stride-N (ì í”„)</strong></td><td>2.0 (ìµœëŒ€)</td><td>ğŸ¢ Worst</td></tr>
                    </table>
                </div>

                <div id="tab-code" class="tab-pane">
                    <p><strong>Best Case (kij) ë¶„ì„:</strong></p>
                    <pre><code><span class="code-keyword">for</span> (k=0; k&lt;n; k++) {
  <span class="code-keyword">for</span> (i=0; i&lt;n; i++) {
    r = a[i][k]; <span class="code-comment">// kê°€ ê³ ì •ë˜ë¯€ë¡œ ì´ ê°’ì€ ë ˆì§€ìŠ¤í„°ì— ìœ ì§€ë¨ (Miss 0)</span>
    <span class="code-keyword">for</span> (j=0; j&lt;n; j++)
      <span class="code-highlight">c[i][j] += r * b[k][j];</span> 
      <span class="code-comment">// c[i][0], c[i][1]... (ê°€ë¡œ ìˆœì°¨ ì ‘ê·¼ -> Good!)</span>
      <span class="code-comment">// b[k][0], b[k][1]... (ê°€ë¡œ ìˆœì°¨ ì ‘ê·¼ -> Good!)</span>
  }
}</code></pre>
                    <p>ë©”ëª¨ë¦¬ êµ¬ì¡°(Row-major)ì™€ ë™ì¼í•˜ê²Œ ê°€ë¡œë¡œ ì½ìœ¼ë¯€ë¡œ <strong>ê³µê°„ ì§€ì—­ì„±(Spatial Locality)</strong>ì´ ìµœì í™”ë©ë‹ˆë‹¤.</p>
                </div>
            </div>
        `,
        'blocking': `
            <h3>ë¸”ë¡œí‚¹ (Blocking) ê¸°ë²•</h3>
            <p>í–‰ë ¬ì´ ë„ˆë¬´ ì»¤ì„œ ìºì‹œì— ë‹¤ ì•ˆ ë“¤ì–´ê°„ë‹¤ë©´? <strong>ì‘ì€ ë¸”ë¡(Sub-matrix)</strong>ìœ¼ë¡œ ìª¼ê°œì„œ ì²˜ë¦¬í•©ì‹œë‹¤.</p>

            <div class="easy-explain">
                <h4>ğŸ“¦ ì´ì‚¿ì§ ë¹„ìœ </h4>
                <p>í° ì§ì„ í•œ ë²ˆì— ë‹¤ ì˜®ê¸°ë ¤ë‹¤ê°„ ì§€ì³ì„œ ë‹¤ ë–¨ì–´ëœ¨ë¦½ë‹ˆë‹¤(Cache Miss). <br>
                ëŒ€ì‹  <strong>ì‘ì€ ìƒì(Block)</strong>ì— ë‚˜ëˆ  ë‹´ì•„ì„œ ì˜®ê¸°ë©´, í•œ ìƒì ì•ˆì˜ ë¬¼ê±´ë“¤ì€ ë‚´ ì† ë‹¿ëŠ” ê³³(ìºì‹œ)ì— ë‘ê³  ë¹ ë¥´ê²Œ ì •ë¦¬í•  ìˆ˜ ìˆì£ .</p>
            </div>

            <canvas id="cvs_blocking"></canvas>
            
            <details>
                <summary>ğŸ“ ìˆ˜ì‹ ìœ ë„ ê³¼ì • ë³´ê¸° (í´ë¦­í•˜ì—¬ í¼ì¹˜ê¸°)</summary>
                <div class="derivation">
                    <p><strong>1. No Blocking (ê¸°ë³¸):</strong></p>
                    <p>í–‰ë ¬ í¬ê¸° Nì´ ìºì‹œë³´ë‹¤ í›¨ì”¬ í¬ë©´, í•œ ì¤„ì„ ì½ì„ ë•Œë§ˆë‹¤ ì´ì „ì— ì½ì€ ë°ì´í„°ê°€ ìºì‹œì—ì„œ ì«“ê²¨ë‚©ë‹ˆë‹¤.</p>
                    <div class="math-block">Total Misses = 9/8 * NÂ³</div>
                    <p>ë¯¸ìŠ¤ìœ¨ì´ NÂ³ì— ë¹„ë¡€í•˜ì—¬ ë§¤ìš° ë†’ìŠµë‹ˆë‹¤.</p>
                    <br>
                    <p><strong>2. Blocking (ë¸”ë¡ í¬ê¸° B):</strong></p>
                    <p>ë¸”ë¡(B x B) ë‹¨ìœ„ë¡œ ê³„ì‚°í•˜ë©´, í•´ë‹¹ ë¸”ë¡ì´ ìºì‹œì— ë¨¸ë¬´ëŠ” ë™ì•ˆ ë°ì´í„°ë¥¼ ìµœëŒ€í•œ ì¬ì‚¬ìš©í•©ë‹ˆë‹¤.</p>
                    <div class="math-block">Total Misses = NÂ³ / (4 * B)</div>
                    <p><strong>ê²°ë¡ :</strong> ë¸”ë¡ í¬ê¸° Bê°€ í´ìˆ˜ë¡(ìºì‹œì— ë“¤ì–´ê°€ëŠ” í•œë„ ë‚´ì—ì„œ) ë¶„ëª¨ê°€ ì»¤ì§€ë¯€ë¡œ <strong>ë¯¸ìŠ¤ìœ¨ì´ ê°ì†Œ</strong>í•©ë‹ˆë‹¤!</p>
                </div>
            </details>
        `
    };

    // --- 4. ì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥ (window ê°ì²´ ë“±ë¡) ---

    window.openModal = function(id) {
        var overlay = document.getElementById('modalOverlay');
        var title = document.getElementById('modalTitle');
        var body = document.getElementById('modalBody');
        
        title.innerText = modalTitles[id] || 'í•™ìŠµ ë‚´ìš©';
        body.innerHTML = contents[id] || '<p>ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>';
        overlay.classList.add('open');
        
        // ì‹œë®¬ë ˆì´ì…˜ ë¦¬ì…‹
        window.simStep = 0;

        // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° (ë Œë”ë§ í›„ ì‹¤í–‰)
        setTimeout(function() {
            if(id === 'set-associative') drawAssociative();
            if(id === 'blocking') drawBlocking();
        }, 50);
    };

    window.closeModal = function() {
        document.getElementById('modalOverlay').classList.remove('open');
    };

    window.switchTab = function(tabName, btn) {
        var container = btn.closest('.tab-container');
        var btns = container.querySelectorAll('.tab-btn');
        var panes = container.querySelectorAll('.tab-pane');

        for(var i=0; i<btns.length; i++) btns[i].classList.remove('active');
        for(var i=0; i<panes.length; i++) panes[i].classList.remove('active');
        
        btn.classList.add('active');
        container.querySelector('#tab-' + tabName).classList.add('active');
    };

    window.nextSimStep = function() {
        var slot = document.getElementById('sim-slot');
        var log = document.getElementById('sim-log');
        
        var steps = [
            { text: "1. CPU: ì£¼ì†Œ 0 ìš”ì²­ (Miss!) -> ë©”ëª¨ë¦¬ì—ì„œ ê°€ì ¸ì™€ ì €ì¥", val: "Data[0]", state: "filled" },
            { text: "2. CPU: ì£¼ì†Œ 8 ìš”ì²­ (Miss!) -> ê°™ì€ ìë¦¬(Set 0)ë¼ ì¶©ëŒ! Data[0] ì«“ê²¨ë‚¨", val: "Data[8]", state: "conflict" },
            { text: "3. CPU: ì£¼ì†Œ 0 ì¬ìš”ì²­ (Miss!) -> ì•„ê¹Œ ì«“ê²¨ë‚˜ì„œ ì—†ë„¤ìš”. Data[8] ì«“ê²¨ë‚¨", val: "Data[0]", state: "conflict" },
            { text: "ê²°ë¡ : ìë¦¬ê°€ í•˜ë‚˜ë¼ì„œ ê³„ì† ì‹¸ì›€ (Thrashing ë°œìƒ)", val: "Data[0]", state: "filled" }
        ];

        if (window.simStep >= steps.length) {
            window.simStep = 0;
            slot.className = "cache-slot";
            slot.innerText = "Empty";
            log.innerText = "ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤. ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.";
            return;
        }

        var curr = steps[window.simStep];
        log.innerText = curr.text;
        slot.innerText = curr.val;
        
        slot.className = "cache-slot";
        void slot.offsetWidth; // ë¦¬í”Œë¡œìš° ê°•ì œ (ì• ë‹ˆë©”ì´ì…˜ ì¬ì‹œì‘)
        slot.classList.add(curr.state);

        window.simStep++;
    };

    // --- 5. ìº”ë²„ìŠ¤ ë“œë¡œì‰ ---
    function drawAssociative() {
        var c = document.getElementById('cvs_assoc'); if(!c) return;
        var ctx = c.getContext('2d');
        var w = c.width = c.clientWidth; var h = c.height = 240;
        ctx.clearRect(0,0,w,h); ctx.lineWidth=2; ctx.font="bold 14px sans-serif";

        // Set Box
        ctx.strokeStyle = "#1e293b";
        ctx.strokeRect(50, 60, 350, 120); 
        ctx.fillStyle="#1e293b"; ctx.fillText("Set i (ì±…ì¥ í•œ ì¹¸)", 50, 50);

        // Way 0
        ctx.fillStyle="#e0e7ff"; ctx.fillRect(70, 80, 130, 80); 
        ctx.strokeRect(70, 80, 130, 80);
        ctx.fillStyle="#4f46e5"; ctx.fillText("Way 0 (ë¹ˆìë¦¬ 1)", 85, 125);
        ctx.strokeRect(80, 90, 40, 60); ctx.fillStyle="#1e293b"; ctx.fillText("Tag", 88, 125);

        // Way 1
        ctx.fillStyle="#e0e7ff"; ctx.fillRect(250, 80, 130, 80); 
        ctx.strokeRect(250, 80, 130, 80);
        ctx.fillStyle="#4f46e5"; ctx.fillText("Way 1 (ë¹ˆìë¦¬ 2)", 265, 125);
        ctx.strokeRect(260, 90, 40, 60); ctx.fillStyle="#1e293b"; ctx.fillText("Tag", 268, 125);

        // Search Logic
        ctx.beginPath();
        ctx.moveTo(225, 20); ctx.lineTo(100, 20); ctx.lineTo(100, 80);
        ctx.moveTo(225, 20); ctx.lineTo(350, 20); ctx.lineTo(350, 80);
        ctx.strokeStyle = "#f43f5e"; ctx.lineWidth = 3; ctx.stroke();

        ctx.fillStyle="#f43f5e"; ctx.fillText("ì…ë ¥ Tagë¥¼ ë™ì‹œì— ë¹„êµ!", 160, 25);
    }

    function drawBlocking() {
        var c = document.getElementById('cvs_blocking'); if(!c) return;
        var ctx = c.getContext('2d');
        var w = c.width = c.clientWidth; var h = c.height = 240;
        ctx.clearRect(0,0,w,h); ctx.lineWidth=2; ctx.font="bold 14px sans-serif";

        // Matrix A
        ctx.strokeRect(40, 40, 120, 120); ctx.fillStyle="#1e293b"; ctx.fillText("Matrix A", 65, 30);
        ctx.fillStyle="#cbd5e1"; ctx.fillRect(40, 40, 120, 120);
        // Block in A
        ctx.fillStyle="#f43f5e"; ctx.fillRect(40, 40, 40, 40); ctx.strokeRect(40, 40, 40, 40);
        ctx.fillStyle="#fff"; ctx.fillText("BxB", 45, 65);

        ctx.fillStyle="#1e293b"; ctx.font="20px sans-serif"; ctx.fillText("X", 180, 110);

        // Matrix B
        ctx.strokeRect(220, 40, 120, 120); ctx.font="bold 14px sans-serif"; ctx.fillText("Matrix B", 245, 30);
        ctx.fillStyle="#cbd5e1"; ctx.fillRect(220, 40, 120, 120);
        // Block in B
        ctx.fillStyle="#4f46e5"; ctx.fillRect(220, 40, 40, 40); ctx.strokeRect(220, 40, 40, 40);
        ctx.fillStyle="#fff"; ctx.fillText("BxB", 225, 65);

        // Explanation
        ctx.fillStyle="#334155"; 
        ctx.fillText("ì‘ì€ ë¸”ë¡(Tile)ë§Œ ìºì‹œì— ë¡œë“œí•˜ì—¬", 80, 200);
        ctx.fillText("ì™„ì „íˆ ê³„ì‚° ëë‚  ë•Œê¹Œì§€ ì¬ì‚¬ìš©!", 90, 220);
        
        // Arrows
        ctx.strokeStyle = "#64748b"; ctx.lineWidth=2;
        ctx.beginPath(); ctx.moveTo(60, 80); ctx.lineTo(60, 180); ctx.stroke();
        ctx.beginPath(); ctx.moveTo(240, 80); ctx.lineTo(240, 180); ctx.stroke();
    }

    // ì‹¤í–‰ (Loading State Check)
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializePage);
    } else {
        initializePage();
    }
</script>
</body>
</html>