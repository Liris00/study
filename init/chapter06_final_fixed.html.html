<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chapter 6: Memory Hierarchy (Fixed)</title>
    <style>
        /* [ìŠ¤íƒ€ì¼] ê¸°ì¡´ ë””ìì¸ ìœ ì§€ + ê¸°ëŠ¥ë³„ ìŠ¤íƒ€ì¼ ê°•í™” */
        @import url('https://fonts.googleapis.com/css2?family=Pretendard:wght@300;400;600;700&display=swap');

        :root { --primary: #4f46e5; --primary-bg: #e0e7ff; --secondary: #1e293b; --bg-main: #f8fafc; --text-main: #334155; --accent: #f43f5e; --success: #22c55e; }
        * { box-sizing: border-box; }
        body { margin: 0; font-family: 'Pretendard', sans-serif; background: var(--bg-main); color: var(--text-main); height: 100vh; display: flex; overflow: hidden; }

        .sidebar { width: 270px; background: var(--secondary); color: white; display: flex; flex-direction: column; padding: 20px; flex-shrink: 0; overflow-y: auto; }
        .main { flex: 1; padding: 40px 60px; overflow-y: auto; background: #f1f5f9; }
        
        .brand { font-size: 1.4rem; font-weight: 800; margin-bottom: 30px; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 20px; }
        .menu-label { font-size: 0.75rem; color: #94a3b8; font-weight: 700; margin: 15px 0 10px 10px; text-transform: uppercase; }
        .nav-item { padding: 12px 15px; margin-bottom: 5px; border-radius: 8px; cursor: pointer; transition: 0.2s; color: #cbd5e1; display: flex; align-items: center; }
        .nav-item:hover { background: rgba(255,255,255,0.1); color: #fff; }
        .nav-item.active { background: var(--primary); color: white; font-weight: 600; }
        .nav-icon { margin-right: 12px; }

        .section-container { display: none; animation: fadeIn 0.3s; max-width: 1000px; margin: 0 auto; }
        .section-container.active { display: block; }
        
        .grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(320px, 1fr)); gap: 25px; padding-bottom: 50px; }
        .card { background: #fff; border-radius: 16px; padding: 25px; border: 1px solid #e2e8f0; cursor: pointer; transition: 0.2s; display: flex; flex-direction: column; }
        .card:hover { transform: translateY(-4px); border-color: var(--primary); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.1); }
        .card-icon { font-size: 2rem; margin-bottom: 15px; background: var(--primary-bg); width: 50px; height: 50px; display: flex; align-items: center; justify-content: center; border-radius: 12px; }
        .btn-learn { margin-top: auto; background: #f8fafc; color: var(--primary); padding: 12px; border-radius: 10px; text-align: center; font-weight: 600; border: 1px solid #e2e8f0; }
        .card:hover .btn-learn { background: var(--primary); color: white; }

        .tag { font-size: 0.75rem; padding: 4px 8px; border-radius: 6px; font-weight: 600; display: inline-block; margin-bottom: 10px; }
        .tag.core { background: #fee2e2; color: #ef4444; }
        .tag.exam { background: #dbeafe; color: #2563eb; }
        .tag.logic { background: #fef3c7; color: #d97706; }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-overlay { position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.5); z-index: 1000; display: none; justify-content: center; align-items: center; }
        .modal-overlay.open { display: flex; }
        .modal-content { background: #fff; width: 90%; max-width: 900px; height: 85vh; border-radius: 20px; display: flex; flex-direction: column; overflow: hidden; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.25); }
        .modal-header { padding: 20px 30px; border-bottom: 1px solid #e2e8f0; display: flex; justify-content: space-between; align-items: center; background: #fff; }
        .modal-body { padding: 40px; overflow-y: auto; line-height: 1.7; color: #334155; }
        .close-btn { font-size: 1.5rem; cursor: pointer; background: none; border: none; }

        /* ê¸°ëŠ¥ ìŠ¤íƒ€ì¼ */
        .easy-explain { background-color: #f0fdf4; border-left: 5px solid var(--success); padding: 15px; margin: 20px 0; border-radius: 4px; }
        .easy-explain h4 { color: #15803d; margin: 0 0 10px 0; }

        details { background: #f8fafc; padding: 15px; border-radius: 8px; border: 1px solid #e2e8f0; margin: 15px 0; cursor: pointer; }
        summary { font-weight: 600; color: var(--primary); }
        .derivation { margin-top: 15px; font-size: 0.95rem; border-top: 1px solid #e2e8f0; padding-top: 10px; cursor: default; }

        .tab-header { display: flex; gap: 10px; border-bottom: 2px solid #e2e8f0; margin-bottom: 20px; }
        .tab-btn { padding: 10px 20px; background: none; border: none; font-weight: 600; color: #94a3b8; cursor: pointer; border-bottom: 2px solid transparent; margin-bottom: -2px; }
        .tab-btn.active { color: var(--primary); border-bottom-color: var(--primary); }
        .tab-pane { display: none; }
        .tab-pane.active { display: block; animation: fadeIn 0.3s; }
        
        pre { background: #1e293b; color: #e2e8f0; padding: 15px; border-radius: 8px; overflow-x: auto; }
        .code-comment { color: #94a3b8; }
        .code-highlight { color: #f43f5e; font-weight: bold; }

        .sim-box { border: 2px solid #e2e8f0; padding: 20px; border-radius: 12px; text-align: center; margin: 20px 0; background: #fff; }
        .cache-state { display: flex; justify-content: center; gap: 10px; margin: 20px 0; }
        .cache-slot { width: 120px; height: 60px; border: 2px dashed #cbd5e1; display: flex; align-items: center; justify-content: center; border-radius: 8px; font-weight: bold; transition: 0.3s; }
        .cache-slot.filled { border-style: solid; border-color: var(--primary); background: #e0e7ff; color: var(--primary); }
        .cache-slot.conflict { animation: shake 0.4s; border-color: var(--accent); background: #ffe4e6; color: var(--accent); }
        .sim-controls button { background: var(--primary); color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; font-weight: 600; }
        .sim-controls button:hover { background: #4338ca; }

        @keyframes shake { 0%, 100% { transform: translateX(0); } 25% { transform: translateX(-5px); } 75% { transform: translateX(5px); } }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .math-block { background: #fff; padding: 10px; border: 1px solid #e2e8f0; text-align: center; margin: 10px 0; border-radius: 8px; }
        canvas { width: 100%; height: 200px; background: #fff; border: 1px solid #e2e8f0; border-radius: 8px; }
    </style>
</head>
<body>

<div class="sidebar">
    <div class="brand">âš¡ Logic Master<br><span style="font-size:0.8rem; color:#94a3b8; font-weight:400;">Final Edition (Fixed)</span></div>
    <div class="menu-label">Chapter 6. Memory Hierarchy</div>
    <div class="nav-item active" onclick="showSection('sec-basic', this)"><span class="nav-icon">ğŸ“š</span> 1. ìºì‹œì˜ ê¸°ë³¸ ì›ë¦¬</div>
    <div class="nav-item" onclick="showSection('sec-mapping', this)"><span class="nav-icon">ğŸ—ºï¸</span> 2. ë§¤í•‘ê³¼ ì‹œë®¬ë ˆì´ì…˜</div>
    <div class="nav-item" onclick="showSection('sec-perf', this)"><span class="nav-icon">ğŸ“Š</span> 3. ì„±ëŠ¥ê³¼ ì •ì±…</div>
    <div class="nav-item" onclick="showSection('sec-opt', this)"><span class="nav-icon">ğŸš€</span> 4. ìµœì í™” (Blocking)</div>
</div>

<div class="main">
    <div id="sec-basic" class="section-container active">
        <div class="header"><h1>1. ìºì‹œ ë©”ëª¨ë¦¬ ê°œìš”</h1><p>ë„ì„œê´€ ë¹„ìœ ë¥¼ í†µí•œ ê³„ì¸µ êµ¬ì¡° ì´í•´</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('cache-concept')">
                <span class="card-icon">ğŸ°</span>
                <div class="tag-container"><span class="tag core">ê°œë…</span></div>
                <h3>ìºì‹œë€ ë¬´ì—‡ì¸ê°€?</h3>
                <p>CPUì™€ ë©”ì¸ ë©”ëª¨ë¦¬ ì‚¬ì´ì˜ ì†ë„ ì°¨ì´ë¥¼ ì¤„ì—¬ì£¼ëŠ” ê³ ì† ì°½ê³ .</p>
                <div class="btn-learn">ì‰¬ìš´ ì„¤ëª… ë³´ê¸°</div>
            </div>
            <div class="card" onclick="openModal('cache-org')">
                <span class="card-icon">ğŸ—‚ï¸</span>
                <div class="tag-container"><span class="tag exam">êµ¬ì¡°</span></div>
                <h3>S, E, B êµ¬ì¡°</h3>
                <p>Set, Line, Blockìœ¼ë¡œ êµ¬ì„±ëœ ìºì‹œì˜ ì£¼ì†Œ ì²´ê³„.</p>
                <div class="btn-learn">ìƒì„¸ êµ¬ì¡° (p.4)</div>
            </div>
        </div>
    </div>

    <div id="sec-mapping" class="section-container">
        <div class="header"><h1>2. ë§¤í•‘ ë°©ì‹ê³¼ ì‹œë®¬ë ˆì´ì…˜</h1><p>ì¶©ëŒ ë¯¸ìŠ¤ ê³¼ì •ì„ ì§ì ‘ ì²´í—˜í•´ë³´ì„¸ìš”.</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('direct-mapped')">
                <span class="card-icon">ğŸ•¹ï¸</span>
                <div class="tag-container"><span class="tag core">ì¸í„°ë™í‹°ë¸Œ</span></div>
                <h3>Direct Mapped (E=1)</h3>
                <p>í•œ ì£¼ì†ŒëŠ” ì˜¤ì§ í•œ ê³³ì—ë§Œ! <strong>ì¶©ëŒ ì‹œë®¬ë ˆì´ì…˜</strong> í¬í•¨.</p>
                <div class="btn-learn">ì‹œë®¬ë ˆì´ì…˜ ì‹œì‘</div>
            </div>
            <div class="card" onclick="openModal('set-associative')">
                <span class="card-icon">ğŸ¤</span>
                <div class="tag-container"><span class="tag exam">ë¹ˆì¶œ</span></div>
                <h3>Set Associative (E>1)</h3>
                <p>ìœ ì—°ì„±ì„ ë”í•´ ì¶©ëŒì„ ì¤„ì´ëŠ” ë°©ì‹. (2-way, 4-way...)</p>
                <div class="btn-learn">ë™ì‘ ì›ë¦¬ (p.11)</div>
            </div>
        </div>
    </div>

    <div id="sec-perf" class="section-container">
        <div class="header"><h1>3. ì“°ê¸° ì •ì±… & ë©”ëª¨ë¦¬ ë§ˆìš´í‹´</h1><p>ë°ì´í„° ì¼ê´€ì„±ê³¼ ì§€ì—­ì„±(Locality) ì‹œê°í™”</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('write-policy')">
                <span class="card-icon">âœï¸</span>
                <div class="tag-container"><span class="tag logic">ì •ì±…</span></div>
                <h3>Write Policy</h3>
                <p>Write-Through vs Write-Back. ì–¸ì œ ë©”ëª¨ë¦¬ì— ì“¸ ê²ƒì¸ê°€?</p>
                <div class="btn-learn">ì¥ë‹¨ì  ë¹„êµ (p.16)</div>
            </div>
            <div class="card" onclick="openModal('mountain')">
                <span class="card-icon">â›°ï¸</span>
                <div class="tag-container"><span class="tag exam">ê·¸ë˜í”„</span></div>
                <h3>The Memory Mountain</h3>
                <p>Stride(ê³µê°„)ì™€ Size(ì‹œê°„)ì— ë”°ë¥¸ ì„±ëŠ¥ ë³€í™” ê·¸ë˜í”„ í•´ì„.</p>
                <div class="btn-learn">ê·¸ë˜í”„ í•´ì„ (p.25)</div>
            </div>
        </div>
    </div>

    <div id="sec-opt" class="section-container">
        <div class="header"><h1>4. ìºì‹œ ì¹œí™”ì  ì½”ë“œ & ë¸”ë¡œí‚¹</h1><p>ì½”ë“œ ë¶„ì„ê³¼ ìˆ˜ì‹ ìœ ë„ë¥¼ í†µí•´ ê¹Šì´ ìˆê²Œ í•™ìŠµí•˜ì„¸ìš”.</p></div>
        <div class="grid">
            <div class="card" onclick="openModal('loop-order')">
                <span class="card-icon">ğŸ”„</span>
                <div class="tag-container"><span class="tag logic">ì½”ë“œ ë¶„ì„</span></div>
                <h3>Loop Reordering</h3>
                <p>ijk vs kij. <strong>ì‹¤ì œ ì½”ë“œ</strong>ë¥¼ ë³´ë©° ë¯¸ìŠ¤ìœ¨ì˜ ì›ì¸ì„ ë¶„ì„í•©ë‹ˆë‹¤.</p>
                <div class="btn-learn">ì½”ë“œ ë¶„ì„ ë³´ê¸°</div>
            </div>
            <div class="card" onclick="openModal('blocking')">
                <span class="card-icon">ğŸ§±</span>
                <div class="tag-container"><span class="tag exam">ìˆ˜ì‹ ìœ ë„</span></div>
                <h3>Blocking (Tiling)</h3>
                <p>í° í–‰ë ¬ì„ ì‘ì€ ë¸”ë¡ìœ¼ë¡œ ìª¼ê°œê¸°. <strong>ë¯¸ìŠ¤ìœ¨ ê³µì‹ ìœ ë„</strong> ê³¼ì • í¬í•¨.</p>
                <div class="btn-learn">ìƒì„¸ í•™ìŠµ (p.43)</div>
            </div>
        </div>
    </div>
</div>

<div class="modal-overlay" id="modalOverlay" onclick="closeModal()">
    <div class="modal-content" onclick="event.stopPropagation()">
        <div class="modal-header">
            <div class="modal-title" id="modalTitle">ì œëª©</div>
            <button class="close-btn" onclick="closeModal()">âœ•</button>
        </div>
        <div class="modal-body" id="modalBody">ë‚´ìš©</div>
    </div>
</div>

<script>
    // --- 1. ì „ì—­ ìƒíƒœ ë° í•¨ìˆ˜ ì •ì˜ ---
    window.simStep = 0;

    // í˜ì´ì§€ ë¡œë“œ ì´ˆê¸°í™” (ì•ˆì „ì¥ì¹˜)
    function initializePage() {
        var firstSection = document.getElementById('sec-basic');
        if(firstSection) firstSection.classList.add('active');
        
        var firstNav = document.querySelector('.nav-item');
        if(firstNav) firstNav.classList.add('active');
    }

    // ì„¹ì…˜ ì „í™˜ í•¨ìˆ˜ (ì „ì—­)
    window.showSection = function(id, el) {
        var sections = document.querySelectorAll('.section-container');
        for(var i=0; i<sections.length; i++) sections[i].classList.remove('active');
        
        var target = document.getElementById(id);
        if(target) target.classList.add('active');

        var navs = document.querySelectorAll('.nav-item');
        for(var i=0; i<navs.length; i++) navs[i].classList.remove('active');
        
        if(el) el.classList.add('active');
    }

    // --- 2. ì½˜í…ì¸  ë°ì´í„° (HTML í¬í•¨) ---
    const contents = {
        'cache-concept': `
            <h3>ìºì‹œ ë©”ëª¨ë¦¬ ê°œìš”</h3>
            <div class="easy-explain">
                <h4>ğŸ“ Univ AIì˜ ì‰¬ìš´ ì„¤ëª…: í˜¸í…” ê¸ˆê³  ë¹„ìœ </h4>
                <p>CPU ì½”ì–´ë¥¼ í˜¸í…” íˆ¬ìˆ™ê°, ë°ì´í„°ë¥¼ ì§ì´ë¼ê³  ìƒê°í•´ë´…ì‹œë‹¤.</p>
                <ul>
                    <li><strong>L1 ìºì‹œ (ê°œì¸ ê¸ˆê³ ):</strong> ë°© ì•ˆì— ìˆì–´ ì¦‰ì‹œ êº¼ë‚¼ ìˆ˜ ìˆìŒ. (4 cycle)</li>
                    <li><strong>L2 ìºì‹œ (ë°© ì•ˆì˜ ì˜·ì¥):</strong> L1ë³´ë‹¤ í¬ì§€ë§Œ ì•½ê°„ ê±¸ë¦¼. (11 cycle)</li>
                    <li><strong>L3 ìºì‹œ (í˜¸í…” ë¡œë¹„ ì°½ê³ ):</strong> ëª¨ë“  íˆ¬ìˆ™ê°ì´ ê³µìœ . (30-40 cycle)</li>
                    <li><strong>ë©”ì¸ ë©”ëª¨ë¦¬ (ì§‘):</strong> í˜¸í…” ë°– ë©€ë¦¬ ìˆìŒ. (100+ cycle)</li>
                </ul>
            </div>
        `,
        'cache-org': `
            <h3>ìºì‹œ ì£¼ì†Œ êµ¬ì¡° (S, E, B)</h3>
            <div class="easy-explain">
                <h4>ğŸ“š ë„ì„œê´€ ë¹„ìœ </h4>
                <ul>
                    <li><strong>Set Index (S):</strong> ì±…ì¥ ë²ˆí˜¸. ëª‡ ë²ˆ ì±…ì¥ìœ¼ë¡œ ê°ˆì§€ ê²°ì •.</li>
                    <li><strong>Tag (T):</strong> ì±… ì œëª© í™•ì¸. ë‚´ê°€ ì°¾ëŠ” ê·¸ ì±…ì´ ë§ëŠ”ì§€ ì‹ë³„.</li>
                    <li><strong>Block Offset (B):</strong> ì±… ë‚´ë¶€ í˜ì´ì§€. ëª‡ í˜ì´ì§€ë¥¼ ì½ì„ì§€ ê²°ì •.</li>
                </ul>
            </div>
            <div class="math-block">Address = [ Tag ] [ Set Index ] [ Block Offset ]</div>
        `,
        'direct-mapped': `
            <h3>Direct Mapped Cache ì‹œë®¬ë ˆì´ì…˜</h3>
            <p>ì£¼ì†Œ 0ë²ˆê³¼ 8ë²ˆì´ ê°™ì€ <strong>Set 0</strong>ì— ë§¤í•‘ë˜ì–´ ì¶©ëŒí•˜ëŠ” ìƒí™©ì…ë‹ˆë‹¤. (Cache Sizeê°€ ì‘ë‹¤ê³  ê°€ì •)</p>
            
            <div class="sim-box">
                <div class="cache-state">
                    <div class="cache-slot" id="sim-slot">Empty</div>
                </div>
                <div class="sim-log" id="sim-log">ë²„íŠ¼ì„ ëˆŒëŸ¬ ì‹œë®¬ë ˆì´ì…˜ì„ ì‹œì‘í•˜ì„¸ìš”.</div>
                <div class="sim-controls">
                    <button onclick="nextSimStep()">ë‹¤ìŒ ë‹¨ê³„ â–¶</button>
                </div>
            </div>
            
            <div class="exam-point">
                <h4>ğŸš© ì¶©ëŒ ë¯¸ìŠ¤ (Conflict Miss)</h4>
                <p>ì„œë¡œ ë‹¤ë¥¸ ë°ì´í„°ê°€ ê°™ì€ ìë¦¬ë¥¼ ì›í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. Direct MappedëŠ” ìë¦¬ê°€ í•˜ë‚˜ë¿ì´ë¼ ê³„ì† ì«“ê²¨ë‚©ë‹ˆë‹¤.</p>
            </div>
        `,
        'set-associative': `
            <h3>E-way Set Associative Cache</h3>
            <p>Direct Mappedì˜ ë‹¨ì  í•´ê²°: í•œ Setì— <strong>Eê°œì˜ ìë¦¬</strong>ë¥¼ ë‘¡ë‹ˆë‹¤.</p>
            <canvas id="cvs_assoc"></canvas>
            <p>ì´ì œ 0ë²ˆê³¼ 8ë²ˆì´ ë“¤ì–´ì™€ë„ ì‹¸ìš°ì§€ ì•Šê³  ì‚¬ì´ì¢‹ê²Œ ì €ì¥ë  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        `,
        'write-policy': `
            <h3>ì“°ê¸° ì •ì±… ë¹„êµ</h3>
            <table>
                <tr><th>ë°©ì‹</th><th>ì„¤ëª…</th><th>íŠ¹ì§•</th></tr>
                <tr><td><strong>Write-Through</strong></td><td>ìºì‹œ + ë©”ëª¨ë¦¬ ë™ì‹œ ê¸°ë¡</td><td>ì•ˆì „í•˜ì§€ë§Œ ëŠë¦¼ (Bus traffic ì¦ê°€)</td></tr>
                <tr><td><strong>Write-Back</strong></td><td>ìºì‹œì—ë§Œ ê¸°ë¡, ë‚˜ì¤‘ì— ë°˜ë‚©</td><td>ë¹ ë¦„, <strong>Dirty Bit</strong> ê´€ë¦¬ í•„ìš”</td></tr>
            </table>
        `,
        'mountain': `
            <h3>The Memory Mountain</h3>
            <p>ê³µê°„/ì‹œê°„ ì§€ì—­ì„±ì— ë”°ë¥¸ ì„±ëŠ¥ ê·¸ë˜í”„ì…ë‹ˆë‹¤.</p>
            <ul>
                <li><strong>Ridges (ëŠ¥ì„ ):</strong> ì‹œê°„ ì§€ì—­ì„±. ë°ì´í„°ê°€ L1/L2ì— ë“¤ì–´ê°ˆìˆ˜ë¡ ë¹ ë¦„.</li>
                <li><strong>Slopes (ë¹„íƒˆ):</strong> ê³µê°„ ì§€ì—­ì„±. Stride(ë³´í­)ê°€ ì‘ì„ìˆ˜ë¡ ë¹ ë¦„.</li>
            </ul>
        `,
        'loop-order': `
            <h3>Loop Reordering (ì½”ë“œ ë¶„ì„)</h3>
            <div class="tab-container">
                <div class="tab-header">
                    <button class="tab-btn active" onclick="switchTab('summary', this)">ìš”ì•½</button>
                    <button class="tab-btn" onclick="switchTab('code', this)">ìƒì„¸ ì½”ë“œ ë¶„ì„</button>
                </div>
                
                <div id="tab-summary" class="tab-pane active">
                    <table>
                        <tr><th>ì½”ë“œ ìˆœì„œ</th><th>ì ‘ê·¼ íŒ¨í„´</th><th>Misses/Iter</th><th>ì„±ëŠ¥</th></tr>
                        <tr><td><code>kij</code>, <code>ikj</code></td><td><strong>Stride-1 (ìˆœì°¨)</strong></td><td>0.5 (ìµœì†Œ)</td><td>ğŸš€ Best</td></tr>
                        <tr><td><code>ijk</code>, <code>jik</code></td><td>í˜¼í•©</td><td>1.25</td><td>Normal</td></tr>
                        <tr><td><code>jki</code>, <code>kji</code></td><td><strong>Stride-N (ì í”„)</strong></td><td>2.0 (ìµœëŒ€)</td><td>ğŸ¢ Worst</td></tr>
                    </table>
                </div>

                <div id="tab-code" class="tab-pane">
                    <p><strong>Best Case (kij):</strong></p>
                    <pre><code>for (k=0; k&lt;n; k++) {
  for (i=0; i&lt;n; i++) {
    r = a[i][k]; <span class="code-comment">// ê³ ì • (ë ˆì§€ìŠ¤í„°)</span>
    for (j=0; j&lt;n; j++)
      <span class="code-highlight">c[i][j] += r * b[k][j];</span> 
      <span class="code-comment">// c[i][0], c[i][1]... (ê°€ë¡œ ìˆœì°¨ ì ‘ê·¼)</span>
      <span class="code-comment">// b[k][0], b[k][1]... (ê°€ë¡œ ìˆœì°¨ ì ‘ê·¼)</span>
  }
}</code></pre>
                    <p>ë©”ëª¨ë¦¬ êµ¬ì¡°(Row-major)ì™€ ë™ì¼í•˜ê²Œ ê°€ë¡œë¡œ ì½ìœ¼ë¯€ë¡œ <strong>ê³µê°„ ì§€ì—­ì„± ìµœì í™”!</strong></p>
                </div>
            </div>
        `,
        'blocking': `
            <h3>ë¸”ë¡œí‚¹ (Blocking)</h3>
            <p>í° í–‰ë ¬ì„ ì‘ì€ ë¸”ë¡(B x B)ìœ¼ë¡œ ìª¼ê°œì–´ ìºì‹œ ì ì¤‘ë¥ ì„ ë†’ì´ëŠ” ê¸°ìˆ ì…ë‹ˆë‹¤.</p>
            <canvas id="cvs_blocking"></canvas>
            
            <details>
                <summary>ğŸ“ ìˆ˜ì‹ ìœ ë„ ê³¼ì • ë³´ê¸° (í´ë¦­)</summary>
                <div class="derivation">
                    <p><strong>1. No Blocking:</strong></p>
                    <p>í–‰ë ¬ í¬ê¸° Nì´ ìºì‹œë³´ë‹¤ í›¨ì”¬ í¬ë©´, í•œ ì¤„ ì½ì„ ë•Œë§ˆë‹¤ ì´ì „ ë°ì´í„°ê°€ ì«“ê²¨ë‚¨.</p>
                    <div class="math-block">Total Misses = 9/8 * NÂ³</div>
                    
                    <p><strong>2. Blocking (í¬ê¸° B):</strong></p>
                    <p>ë¸”ë¡(B x B) ë‹¨ìœ„ë¡œ ê³„ì‚°í•˜ë©´, ë¸”ë¡ì´ ìºì‹œì— ë¨¸ë¬´ëŠ” ë™ì•ˆ ë°ì´í„°ë¥¼ ì¬ì‚¬ìš©í•¨.</p>
                    <div class="math-block">Total Misses = NÂ³ / (4 * B)</div>
                    <p>=> ë”°ë¼ì„œ ë¸”ë¡ í¬ê¸° Bê°€ í´ìˆ˜ë¡(ìºì‹œì— ë“¤ì–´ê°€ëŠ” í•œë„ ë‚´ì—ì„œ) ë¯¸ìŠ¤ìœ¨ì´ ê°ì†Œí•¨!</p>
                </div>
            </details>
        `
    };

    // --- 3. ì¸í„°ë™í‹°ë¸Œ ê¸°ëŠ¥ í•¨ìˆ˜ (ì „ì—­ ë“±ë¡) ---

    // íƒ­ ì „í™˜ (this ì „ë‹¬ë¡œ ì´ë²¤íŠ¸ ë¬¸ì œ í•´ê²°)
    window.switchTab = function(tabName, btn) {
        // ëª¨ë“  ë²„íŠ¼ ë¹„í™œì„±í™”
        var btns = document.querySelectorAll('.tab-btn');
        for(var i=0; i<btns.length; i++) btns[i].classList.remove('active');
        
        // ëª¨ë“  íƒ­ ë‚´ìš© ìˆ¨ê¸°ê¸°
        var panes = document.querySelectorAll('.tab-pane');
        for(var i=0; i<panes.length; i++) panes[i].classList.remove('active');
        
        // ì„ íƒëœ ë²„íŠ¼ ë° íƒ­ í™œì„±í™”
        btn.classList.add('active');
        var targetPane = document.getElementById('tab-' + tabName);
        if(targetPane) targetPane.classList.add('active');
    };

    // ì‹œë®¬ë ˆì´ì…˜ ë‹¨ê³„ ì§„í–‰
    window.nextSimStep = function() {
        var slot = document.getElementById('sim-slot');
        var log = document.getElementById('sim-log');
        
        var steps = [
            { text: "1. CPU: ì£¼ì†Œ 0 ìš”ì²­ (Miss!) -> ë©”ëª¨ë¦¬ ë¡œë“œ", val: "Data[0]", state: "filled" },
            { text: "2. CPU: ì£¼ì†Œ 8 ìš”ì²­ (Miss!) -> ì¶©ëŒ ë°œìƒ! Data[0] ì«“ê²¨ë‚¨", val: "Data[8]", state: "conflict" },
            { text: "3. CPU: ì£¼ì†Œ 0 ì¬ìš”ì²­ (Miss!) -> ì¶©ëŒ ë°œìƒ! Data[8] ì«“ê²¨ë‚¨", val: "Data[0]", state: "conflict" },
            { text: "ê²°ë¡ : ìë¦¬ê°€ í•˜ë‚˜ë¼ì„œ ê³„ì† ì‹¸ì›€ (Thrashing)", val: "Data[0]", state: "filled" }
        ];

        if (window.simStep >= steps.length) {
            window.simStep = 0;
            slot.className = "cache-slot";
            slot.innerText = "Empty";
            log.innerText = "ë‹¤ì‹œ ì‹œì‘í•©ë‹ˆë‹¤.";
            return;
        }

        var curr = steps[window.simStep];
        log.innerText = curr.text;
        slot.innerText = curr.val;
        
        // ì• ë‹ˆë©”ì´ì…˜ ì¬ìƒì„ ìœ„í•œ í´ë˜ìŠ¤ ë¦¬ì…‹
        slot.className = "cache-slot";
        void slot.offsetWidth; // reflow ê°•ì œ
        slot.classList.add(curr.state);

        window.simStep++;
    };

    // ëª¨ë‹¬ ì—´ê¸°
    window.openModal = function(id) {
        var overlay = document.getElementById('modalOverlay');
        var title = document.getElementById('modalTitle');
        var body = document.getElementById('modalBody');
        
        title.innerText = modalTitles[id] || 'í•™ìŠµ ë‚´ìš©';
        body.innerHTML = contents[id] || '<p>ì¤€ë¹„ ì¤‘ì…ë‹ˆë‹¤.</p>';
        overlay.classList.add('open');
        
        // ì‹œë®¬ë ˆì´ì…˜ ë¦¬ì…‹
        window.simStep = 0;

        // ìº”ë²„ìŠ¤ ê·¸ë¦¬ê¸° (DOM ë Œë”ë§ í›„ ì‹¤í–‰)
        setTimeout(function() {
            if(id === 'set-associative') drawAssociative();
            if(id === 'blocking') drawBlocking();
        }, 50);
    };

    window.closeModal = function() {
        document.getElementById('modalOverlay').classList.remove('open');
    };

    // ìº”ë²„ìŠ¤ ë“œë¡œì‰ í•¨ìˆ˜ë“¤
    function drawAssociative() {
        var c = document.getElementById('cvs_assoc'); if(!c) return;
        var ctx = c.getContext('2d');
        var w = c.width = c.clientWidth; var h = c.height = 180;
        ctx.clearRect(0,0,w,h); ctx.lineWidth=2; ctx.font="14px sans-serif";

        ctx.strokeRect(50, 40, 300, 100); ctx.fillStyle="#1e293b"; ctx.fillText("Set (ì±…ì¥)", 20, 95);
        ctx.fillStyle="#eff6ff"; ctx.fillRect(60, 50, 120, 80); ctx.strokeRect(60, 50, 120, 80);
        ctx.fillStyle="#1e293b"; ctx.fillText("Way 0", 100, 95);
        ctx.fillStyle="#eff6ff"; ctx.fillRect(200, 50, 120, 80); ctx.strokeRect(200, 50, 120, 80);
        ctx.fillStyle="#1e293b"; ctx.fillText("Way 1", 240, 95);
        ctx.fillStyle="#f43f5e"; ctx.fillText("ë™ì‹œ ë¹„êµ!", 180, 160);
    }

    function drawBlocking() {
        var c = document.getElementById('cvs_blocking'); if(!c) return;
        var ctx = c.getContext('2d');
        var w = c.width = c.clientWidth; var h = c.height = 180;
        ctx.clearRect(0,0,w,h); ctx.lineWidth=2; ctx.font="12px sans-serif";

        ctx.strokeRect(50, 30, 100, 100); ctx.fillText("Matrix A", 70, 20);
        ctx.fillStyle="#cbd5e1"; ctx.fillRect(50, 30, 100, 100);
        ctx.fillStyle="#f43f5e"; ctx.fillRect(50, 30, 30, 30); ctx.strokeRect(50, 30, 30, 30);
        
        ctx.strokeRect(200, 30, 100, 100); ctx.fillText("Matrix B", 220, 20);
        ctx.fillStyle="#cbd5e1"; ctx.fillRect(200, 30, 100, 100);
        ctx.fillStyle="#4f46e5"; ctx.fillRect(200, 30, 30, 30); ctx.strokeRect(200, 30, 30, 30);

        ctx.fillStyle="#334155"; ctx.fillText("ì‘ì€ ë¸”ë¡(Tile)ë§Œ ë¡œë“œ", 100, 150);
        ctx.beginPath(); ctx.moveTo(65, 60); ctx.lineTo(65, 130); ctx.lineTo(150, 130); ctx.stroke();
    }

    // ëª¨ë‹¬ íƒ€ì´í‹€ ë§¤í•‘
    const modalTitles = {
        'cache-concept': 'ìºì‹œ ë©”ëª¨ë¦¬ë€?',
        'cache-org': 'ìºì‹œì˜ ì£¼ì†Œ êµ¬ì¡° (S, E, B)',
        'direct-mapped': 'Direct Mapped Cache ì‹œë®¬ë ˆì´ì…˜',
        'set-associative': 'Set Associative Cache ë™ì‘',
        'write-policy': 'ì“°ê¸° ì •ì±… (Write Policy)',
        'mountain': 'ë©”ëª¨ë¦¬ ë§ˆìš´í‹´ (Memory Mountain)',
        'loop-order': 'ë£¨í”„ ìˆœì„œì™€ ê³µê°„ ì§€ì—­ì„±',
        'blocking': 'ë¸”ë¡œí‚¹ (Blocking) ê¸°ë²•'
    };

    // ë¡œë”© ì™„ë£Œ ì‹œ ì‹¤í–‰
    if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', initializePage);
    } else {
        initializePage();
    }
</script>
</body>
</html>